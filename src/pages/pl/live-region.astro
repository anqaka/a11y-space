---
import Layout from '../../layouts/Layout.astro';
import { t } from '../../i18n/utils';
---

<Layout title={t('liveRegion.title')} description="Poprawiamy dostępność!" lang="pl">
  <div class="container mx-auto flex flex-col py-6 flex-grow">
    <h1 class="mb-8 text-4xl font-bold text-primary text-center">{t('liveRegion.title')}</h1>
    <div class="my-6 grid grid-flow-row gap-6 grid-cols-1 md:grid-cols-2">
      <div>
        <h2 id="form-heading" class="text-2xl text-center">{t('liveRegion.yourMessage')}</h2>
        <form id="msg-form" aria-labelledby="form-heading" class="flex flex-col items-center">
          <div class="input-field py-6 flex flex-col">
            <label for="msg-field">{t('liveRegion.yourMessage')}</label>
            <input type="text" id="msg-field" name="message" placeholder={t('liveRegion.yourMessageForPenguin')} class="w-[300px] form-input rounded" aria-describedby="msg-error" />
            <p class="error-info hidden text-red-600" id="msg-error">{t('liveRegion.error')}</p>
          </div>
          <button type="submit" class="btn w-[300px]">{t('liveRegion.submit')}</button>
        </form>
      </div>
      <section class="p-6" aria-labelledby="msg-heading">
        <div aria-live="polite" aria-atomic="true" id="live-region">
          <h2 id="msg-heading" class="text-2xl font-bold mb-4">{t('liveRegion.dearPenguin')}</h2>
          <p id="penguin-message" class="hidden mb-6"></p>
          <p class="msg-placeholder">{t('liveRegion.placeholder')}</p>
        </div>
      </section>
    </div>
    <div class="flex justify-center"><button type="button" class="btn clear-btn">{t('liveRegion.clear')}</button></div>
  </div>
</Layout>
<script>
const formMsg = document.querySelector('#msg-form')
const msgField = document.querySelector('#msg-field')
const errorMsgContainer = document.querySelector('.error-info')
const penguinMsg = document.querySelector('#penguin-message')
const msgPlaceholder = document.querySelector('.msg-placeholder')
const liveRegionWrapper = document.querySelector('#live-region')
const clearBtn = document.querySelector('.clear-btn')

formMsg?.addEventListener('submit', (e) => {
  e.preventDefault();
  if (msgField?.value) {
    penguinMsg.innerHTML = msgField.value
    penguinMsg.classList.remove('hidden')
    msgPlaceholder.classList.add('hidden')
    if (document.querySelector('#ai-pengiun')) {
      document.querySelector('#ai-pengiun').remove()
    }
    const randomInt = Math.floor(Math.random() * 13);
    const img = document.createElement('img');
    img.src = `/penguin-${randomInt}.jpeg`
    img.alt = 'losowy pingwin wygenerowany przez AI'
    img.id = 'ai-pengiun'
    liveRegionWrapper.appendChild(img)
  } else {
    errorMsgContainer.classList.remove('hidden')
    msgField.focus()
  }
})

msgField.addEventListener('input', (e) => {
  if (!errorMsgContainer.classList.contains('hidden')) {
    errorMsgContainer.classList.add('hidden')
  }
})

clearBtn.addEventListener('click', () => {
  penguinMsg.innerHTML = ''
  const imgPenguin = document.querySelector('#ai-pengiun')
  if (imgPenguin) {
    imgPenguin.remove()
  }
  if (msgPlaceholder.classList.contains('hidden')) {
    msgPlaceholder.classList.remove('hidden')
  }
  msgField.value = ''
})
</script>
